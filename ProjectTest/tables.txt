/*THESE TABLES ARE ALMOST COMPLETE THEY STILL NEEED.
- Cascade deletion as specified in our docs
- the functions that we also specified*/ 

CREATE TABLE hotel_chain(
chain_ID int NOT NULL,
centAddress VARCHAR(150),
name VARCHAR(150),
email VARCHAR(256),
nTelephone VARCHAR(20), /*I put 12 to adjust international size 
calling to canada and other countriesUsing the modern global 
format for telephone numbers, a Canadian number would be 
written as +1NPANXXXXXX -WIKIPEDIA (Im not including the + sign)
mind you this can be checked instead when putting a check */
chainRating int,
--nHotels(), Kevin will make this function
PRIMARY KEY(chain_ID)
);

CREATE TABLE app_hotel(
    hotelAddress VARCHAR(150),
    hotel_ID int NOT NULL,
    --nRooms(), KEVIN FUNCTION
	name VARCHAR(150),
    nTelephone VARCHAR(20),
	chain_ID int,
    rating int,
	image_url VARCHAR(500),
    PRIMARY KEY(hotel_ID),
	FOREIGN KEY (chain_ID) REFERENCES hotel_chain
);

CREATE TABLE capacity(
    size_name VARCHAR(20),
	capacity_ID int NOT NULL,
    PRIMARY KEY(capacity_ID)
);

CREATE TABLE views(
    description VARCHAR(20),
	views_ID int NOT NULL,
    PRIMARY KEY(views_ID)
);



CREATE TABLE client(
    FirstName   VARCHAR(50) NOT NULL,
    MiddleName  VARCHAR(50),
    LastName   VARCHAR(50) NOT NULL,
    cAddress VARCHAR(150),
    SSN_client int NOT NULL,
    PRIMARY KEY (SSN_client)
);

CREATE TABLE employee(
    FirstName         VARCHAR(50) NOT NULL,
    MiddleName    VARCHAR(50),
    LastName          VARCHAR(50)NOT NULL,
    eAddress VARCHAR(254),
    role VARCHAR(15),
    SSN_employee int NOT NULL,
    PRIMARY KEY(SSN_employee)
);

CREATE TABLE reservation(
    sTime TIMESTAMP DEFAULT NULL,
    eTime TIMESTAMP DEFAULT NULL,
    client_ID int NOT NULL,
	FOREIGN KEY (client_ID) REFERENCES client,
    hotel_ID int NOT NULL,
	FOREIGN KEY (hotel_ID) REFERENCES hotel,
    views VARCHAR(50),
    capacity VARCHAR(15),
    extraBed BOOLEAN,
    PRIMARY KEY (client_ID,hotel_ID,sTime)
);

CREATE TABLE damage(
    damage_ID int NOT NULL,
    rNumber int,
	hotel_ID int,
	FOREIGN KEY (rNumber,hotel_ID) REFERENCES room,
	/* In the lack of a better way to connect each damage
	to its room id which is composite I used both of the elements of
	the composite primary key in room */
    description VARCHAR(200),
    PRIMARY KEY (damage_ID)
);

CREATE TABLE commodity(
    commodity_ID int NOT NULL AUTO_INCREMENT,
    type VARCHAR(10),
    description CHAR(25),
    PRIMARY KEY(commodity_ID)
);

CREATE TABLE commodity(
    commodity_ID int NOT NULL,
    type VARCHAR(10),
    description CHAR(25),
    PRIMARY KEY(commodity_ID)
);

/*NOTICE THAT IN LOCATION
 S time needs to be the same
 as in reservation (But the ennd time might change so we need to fix that) 
 I also added hotel id here to not lose track of which specific room we are talking about*/
SET search_path = 'SAILORS';
CREATE TABLE location(
    location_ID int NOT NULL,
    sTime TIMESTAMP DEFAULT NULL,
    eTime TIMESTAMP DEFAULT NULL,
    in_person BOOLEAN,
    client_ID int NOT NULL,
    hotel_ID int NOT NULL,
    SSN_employee int NOT NULL,
    rNumber int NOT NULL,
    FOREIGN KEY (SSN_employee) REFERENCES employee,
    FOREIGN KEY (client_ID,hotel_ID,sTime) REFERENCES reservation,
    PRIMARY KEY(location_ID)
);

CREATE TABLE payment(
    payment_ID int NOT NULL,
    amount FLOAT,
    method VARCHAR(25),
    client_ID int NOT NULL,
    FOREIGN KEY (client_ID) REFERENCES client,
    location_ID int NOT NULL,
    FOREIGN KEY (location_ID) REFERENCES location,
    PRIMARY KEY(payment_ID)
);

/*(10%) L’utilisateur doit pouvoir également voir deux vues spécifiques. Vous devez
implémenter les vues en tant que vues SQL. Vue 1: la première vue est le nombre de chambres
disponibles par zone. Vue 2: la deuxième vue est la capacité de toutes les chambres d’un hôtel
spécifique. 


THE VIEW BELLOW IS FOR VIEW 2.
It includes the information a client would probably
want to see when booking a hotel,
so it doesnt include damages or any of the ids just rNumber*/

CREATE VIEW Room_Info_with_Capacity AS
SELECT H.name,H.hoteladdress,
H.ntelephone,H.hotelrating,R.rNumber,
C.size_name, V.description, R.price
FROM hotel H 
NATURAL JOIN room R NATURAL JOIN capacity C
GROUP BY C.size_name;

CREATE VIEW 

CREATE TABLE room(
    price FLOAT,
    capaCity_ID int,
	FOREIGN KEY (capacity_ID) REFERENCES capacity,
    extra_bed BOOLEAN,
    views_ID int,
	/* Here THE REFERENCES IS GOING TO BE TO VIEWS 
	ID A NUMBER WHICH IN THE TABLE VIEWS MATCHES
	WITH A DESCRIPTION*/
	FOREIGN KEY(views_ID) REFERENCES views,
	hotel_ID int NOT NULL,
	FOREIGN KEY(hotel_ID) REFERENCES hotel,
    --available (),;KEVIN FUNCTIUOBN
    rNumber INT NOT NULL,
    PRIMARY KEY (rNumber,hotel_ID)
);